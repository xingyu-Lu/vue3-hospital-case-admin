var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l;import{P as d,a5 as i,K as m,V as n,u,r as c,j as p,h as g,a6 as f,t as h,i as _,L as F,M as b,Y as v,Z as y,_ as V,$ as j,B as x,a7 as k,a8 as R,E as U,N as L,O as w,F as S,w as q,o as O,d as A,c as P,G as I,H as B,b as E,m as z,e as $,n as C}from"./vendor.58cdc006.js";/* empty css                *//* empty css                     *//* empty css                *//* empty css                 *//* empty css                  *//* empty css                     *//* empty css                 */import{a as D,u as G}from"./index.d6e5daca.js";const H={name:"news_add",components:{Plus:d,Delete:i},setup(){const e=m(null),d=m(null),i=m(null),F=m(null),b=n(),v=u(),{id:y}=b.query,V=c({token:"Bearer "+D("token")||"",id:y,Form:{attachment:"",video:"",img_url:"",img:"",name:"",age:"",sex:"0",abstract:"",diagnosis:"",diagnosis_result:"",general_seen:"",type_id:"",part:"",disabled:!0,fileList:[],attachmentFileList:[],videoFileList:[],list:[]},rules:{img:[{required:!1,message:"图片必须",trigger:["change"]}],video:[{required:!1,message:"视频必须",trigger:["change"]}],attachment:[{required:!1,message:"附件必须",trigger:["change"]}],name:[{required:!0,message:"姓名必须",trigger:["change"]}],age:[{required:!0,message:"年龄必须",trigger:["change"]}],sex:[{required:!0,message:"性别必须",trigger:["change"]}],abstract:[{required:!0,message:"摘要必须",trigger:["change"]}],type_id:[{required:!0,message:"病例类型必须",trigger:["change"]}],part:[{required:!0,message:"病例部位必须",trigger:["change"]}]}});p((()=>{j(),y&&g.get(`/api/back/cases/${y}`).then((e=>{V.Form={attachment:e.data.attachment_id,attachmentFileList:e.data.attachment,video:e.data.video_id,videoFileList:e.data.video,img_url:e.data.img_url||"",img:e.data.img_id,name:e.data.name,age:e.data.age,sex:String(e.data.sex),abstract:e.data.abstract,diagnosis:e.data.diagnosis,diagnosis_result:e.data.diagnosis_result,general_seen:e.data.general_seen,type_id:e.data.type_id,part:e.data.part,fileList:[{url:e.data.img_url}],disabled:!0}}))}));const j=async()=>{const e=await g.get("/api/back/caseTypes");V.Form.list=e.data};f((()=>{}));return x=((e,a)=>{for(var t in a||(a={}))r.call(a,t)&&s(e,t,a[t]);if(l)for(var t of l(a))o.call(a,t)&&s(e,t,a[t]);return e})({},h(V)),a(x,t({videoRef:d,attachmentRef:e,uploadRef:F,Ref:i,submitAdd:()=>{i.value.validate((e=>{if(e){let e=g.post,a={attachment:V.Form.attachment,video:V.Form.video,img:V.Form.img,name:V.Form.name,age:V.Form.age,sex:V.Form.sex,abstract:V.Form.abstract,diagnosis:V.Form.diagnosis,diagnosis_result:V.Form.diagnosis_result,general_seen:V.Form.general_seen,type_id:V.Form.type_id,part:V.Form.part},t="/api/back/cases";y&&(e=g.put,t=`/api/back/cases/${y}`),e(t,a).then((()=>{y?_.success("修改成功"):_.success("添加成功"),v.push({path:"/case-index"})}))}}))},uploadImgServer:G,handleBeforeUpload:e=>{const a=e.name.split(".")[1]||"";if(!["jpg","jpeg","png","gif"].includes(a))return _.error("请上传 jpg、jpeg、png、gif 格式的图片"),!1},handleUrlSuccess:e=>{_.success("上传成功"),V.Form.img_url=e.data.src||"",V.Form.img=e.data.id||""},handleUrlError:e=>{_.error("上传失败")},handleRemove:e=>{F.value.clearFiles(),V.Form.img="",V.Form.img_url="",V.Form.fileList=[]},handleAttachmentSuccess:e=>{_.success("上传成功"),V.Form.attachment?V.Form.attachment=V.Form.attachment+","+e.data.id:V.Form.attachment=e.data.id},handleAttachmentRemove:a=>{e.value.clearFiles(),V.Form.attachment="",V.Form.attachmentFileList=[]},handleVideoSuccess:e=>{_.success("上传成功"),V.Form.video=e.data.id},handleVideoRemove:e=>{d.value.clearFiles(),V.Form.video="",V.Form.videoFileList=[]}}));var x}},K=$("女"),M=$("男"),N=["src"],T={class:"el-upload-list__item-actions"},Y=$("上传"),Z=$("上传");H.render=function(e,a,t,l,r,o){const s=F,d=b,i=v,m=y,n=V,u=j,c=x("plus"),p=k,g=x("delete"),f=R,h=U,_=L,D=w;return O(),S(D,{style:{"min-height":"100%"}},{default:q((()=>[A(_,{model:e.Form,rules:e.rules,ref:"Ref","label-width":"100px"},{default:q((()=>[A(d,{label:"姓名",prop:"name"},{default:q((()=>[A(s,{modelValue:e.Form.name,"onUpdate:modelValue":a[0]||(a[0]=a=>e.Form.name=a),placeholder:"请输入病员姓名",type:"text"},null,8,["modelValue"])])),_:1}),A(d,{label:"年龄",prop:"age"},{default:q((()=>[A(s,{modelValue:e.Form.age,"onUpdate:modelValue":a[1]||(a[1]=a=>e.Form.age=a),placeholder:"请输入病员姓名",type:"number"},null,8,["modelValue"])])),_:1}),A(d,{label:"性别",prop:"sex"},{default:q((()=>[A(m,{modelValue:e.Form.sex,"onUpdate:modelValue":a[2]||(a[2]=a=>e.Form.sex=a)},{default:q((()=>[A(i,{label:"1"},{default:q((()=>[K])),_:1}),A(i,{label:"0"},{default:q((()=>[M])),_:1})])),_:1},8,["modelValue"])])),_:1}),A(d,{label:"病例类型",prop:"type_id"},{default:q((()=>[A(u,{modelValue:e.Form.type_id,"onUpdate:modelValue":a[3]||(a[3]=a=>e.Form.type_id=a),placeholder:"请选择病例类型"},{default:q((()=>[(O(!0),P(B,null,I(e.Form.list,(e=>(O(),S(n,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),A(d,{label:"病例部位",prop:"part"},{default:q((()=>[A(s,{modelValue:e.Form.part,"onUpdate:modelValue":a[4]||(a[4]=a=>e.Form.part=a),placeholder:"请输入病例部位",type:"text"},null,8,["modelValue"])])),_:1}),A(d,{label:"摘要",prop:"abstract"},{default:q((()=>[A(s,{modelValue:e.Form.abstract,"onUpdate:modelValue":a[5]||(a[5]=a=>e.Form.abstract=a),placeholder:"请输入摘要",rows:2,type:"textarea"},null,8,["modelValue"])])),_:1}),A(d,{label:"临床诊断",prop:"diagnosis"},{default:q((()=>[A(s,{modelValue:e.Form.diagnosis,"onUpdate:modelValue":a[6]||(a[6]=a=>e.Form.diagnosis=a),placeholder:"请输入诊断",rows:2,type:"textarea"},null,8,["modelValue"])])),_:1}),A(d,{label:"诊断结果",prop:"diagnosis_result"},{default:q((()=>[A(s,{modelValue:e.Form.diagnosis_result,"onUpdate:modelValue":a[7]||(a[7]=a=>e.Form.diagnosis_result=a),placeholder:"请输入诊断结果",rows:2,type:"textarea"},null,8,["modelValue"])])),_:1}),A(d,{label:"大体所见",prop:"general_seen"},{default:q((()=>[A(s,{modelValue:e.Form.general_seen,"onUpdate:modelValue":a[8]||(a[8]=a=>e.Form.general_seen=a),placeholder:"请输入大体所见",rows:2,type:"textarea"},null,8,["modelValue"])])),_:1}),A(d,{label:"图片",prop:"img"},{default:q((()=>[A(f,{ref:"uploadRef",action:l.uploadImgServer,data:{basket:"img"},limit:1,"list-type":"picture-card","thumbnail-mode":"true",headers:{Authorization:e.token},"before-upload":l.handleBeforeUpload,"on-success":l.handleUrlSuccess,"on-error":l.handleUrlError,"auto-upload":!0,"file-list":e.Form.fileList},{default:q((()=>[A(p,null,{default:q((()=>[A(c)])),_:1})])),file:q((({file:t})=>[E("div",null,[e.Form.img_url?(O(),P("img",{key:0,class:"el-upload-list__item-thumbnail",src:e.Form.img_url,alt:""},null,8,N)):z("",!0),E("span",T,[e.Form.disabled?(O(),P("span",{key:0,class:"el-upload-list__item-delete",onClick:a[9]||(a[9]=(...e)=>l.handleRemove&&l.handleRemove(...e))},[A(p,null,{default:q((()=>[A(g)])),_:1})])):z("",!0)])])])),_:1},8,["action","headers","before-upload","on-success","on-error","file-list"])])),_:1}),A(d,{label:"视频",prop:"video"},{default:q((()=>[A(f,{ref:"videoRef",headers:{Authorization:e.token},action:l.uploadImgServer,"on-remove":l.handleVideoRemove,"on-success":l.handleVideoSuccess,"auto-upload":!0,data:{basket:"video"},limit:1,multiple:"","file-list":e.Form.videoFileList},{default:q((()=>[A(h,{type:"primary"},{default:q((()=>[Y])),_:1})])),_:1},8,["headers","action","on-remove","on-success","file-list"])])),_:1}),A(d,{label:"附件",prop:"attachment"},{default:q((()=>[A(f,{ref:"attachmentRef",headers:{Authorization:e.token},action:l.uploadImgServer,"on-remove":l.handleAttachmentRemove,"on-success":l.handleAttachmentSuccess,"auto-upload":!0,data:{basket:"attachment"},limit:3,multiple:"","file-list":e.Form.attachmentFileList},{default:q((()=>[A(h,{type:"primary"},{default:q((()=>[Z])),_:1})])),_:1},8,["headers","action","on-remove","on-success","file-list"])])),_:1}),A(d,null,{default:q((()=>[A(h,{type:"primary",onClick:a[10]||(a[10]=e=>l.submitAdd())},{default:q((()=>[$(C(e.id?"立即修改":"立即创建"),1)])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1})};export{H as default};
